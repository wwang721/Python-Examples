# How to use Inkscape while keeping fonts in figures generated by Matplotlib

When generating figures in PDF format with Matplotlib using fonts other than the default "DejaVu Sans" (e.g., Times New Roman), importing the PDF into Inkscape may result in incorrect font rendering. If you choose to import the text as paths, the font appearance is preserved, but the text becomes uneditable, meaning you cannot select, edit, copy, or paste it.

Here is a possible solution to address this issue:

* Generate figures in SVG format and embed the fonts by setting `plt.rcParams['svg.fonttype']='none'`. By default, Matplotlib saves text as paths when creating SVG files.

> Note: if you enable TeX for rendering math expression by setting `"text.usetex": True`, all text will be save as paths, overriding the `plt.rcParams['svg.fonttype']='none'` setting.


However, the font for math text remains "DejaVu Sans," which does not match the other text. To resolve this, I change the math text font to something more consistent, such as "Computer Modern (TeX)." Unfortunately, the SVG file may not render correctly if the required fonts are not installed locally. To fix this issue, I downloaded and installed the missing fonts, such as "cmr10.ttf," which can be found [here](https://github.com/ClassroomPresenter/CP3/blob/master/Fonts/cmr10.ttf). You can also open the SVG file in a text editor to identify which fonts are missing.
Alternatively, there is an even ***simpler method***: you can directly open the Matplotlib font folder (see how to locate the font folder [here](#how-to-install-fonts-for-matplotlib)) and install the desired fonts there.
> Caveat: Avoid installing the STIX fonts in Matplotlib's font folder, as this can cause conflicts with websites that use MathJax for rendering mathematical expressions, such as [Stack Exchange Mathematics](https://math.stackexchange.com/questions/2341006/why-is-the-saddlepoint-approximation-called-a-saddlepoint-approximation).


There are still issues with the "Computer Modern (TeX)" font when using expressions like `$\langle x\rangle$` to generate $\langle x\rangle$, the left bracket is missing, and the right bracket appears disproportionately large. To address this, I use `$\left< x\right>$` instead and ***manually*** adjust the font size in the SVG source file as needed.

> Update: After opening the "cmex10.ttf" font in [**Glyphr Studio**](https://www.glyphrstudio.com/online), I discovered that `$\langle$` is missing because it corresponds to a "soft hyphen" in this font, which is actually invisible (even tried to use its Unicode in the SVG source file, but it still does not appear). Similarly, `$\rangle$` corresponds to the registered sign ® in the font. To address this issue, I used Glyphr Studio to create a customized font, "[Mycmex10.otf](/plot_template/Inkscape/Mycmex10-Regular.otf)", mapping the Kanbun character ㆑ to `$\langle$`. After installing this customized font, I edited the SVG source file (replacing "cmex10" with "Mycmex10" and adding ㆑ in front of ®), and now everything works as expected!

## How to install fonts for Matplotlib

Sometimes, Matplotlib may return the error: `"findfont: Font family ['Times New Roman'] not found. Falling back to DejaVu Sans."`

To manually install a font for Matplotlib, follow these steps:

1. Run the following code to locate the Matplotlib configuration directory:
``` python
import matplotlib
print(matplotlib.matplotlib_fname())
```
This will output a file path, such as: `/home/wwang/anaconda3/lib/python3.8/site-packages/matplotlib/mpl-data/matplotlibrc`.

2. Navigate to the directory `mpl-data`. Inside it, you will find a `font/ttf` subdirectory.
3. Copy the desired `.ttf` font file into the `font/ttf` directory.
4. Clear the Matplotlib font cache by running: `rm -rf ~/.cache/matplotlib`.
5. Rerun your Python code, and the new font should now work correctly.

## How to save a figure in EPS format

According to the [Matplotlib documentation](https://matplotlib.org/stable/users/explain/text/usetex.html#postscript-options), to generate scalable EPS files, you need to set `plt.rcParams["ps.usedistiller"] = "xpdf"`.
This configuration requires [**Ghostscript**](https://ghostscript.com/releases/gsdnld.html) to be installed locally.

You can save a figure as `.eps` instead of `.svg` in **Inkscape**. However, this function is not in `Export...` but in `Save As...`.
